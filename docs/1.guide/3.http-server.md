---
icon: ic:baseline-http
---

# HTTP 服务器

> 我们可以将 unstore 的实例暴露给 HTTP 服务器以允许远程连接。

请求 URL 被映射到一个键，方法/请求体被映射到一个函数。请查看下方支持的 HTTP 方法。

## 存储服务器

以编程方式创建一个 HTTP 服务器，以暴露与 `storage` 实例通信的方法：

```js [server.js]
import { listen } from "listhen";
import { createStorage } from "unstorage";
import { createStorageServer } from "unstorage/server";

const storage = createStorage();
const storageServer = createStorageServer(storage, {
  authorize(req) {
    // req: { key, type, event }
    if (req.type === "read" && req.key.startsWith("private:")) {
      throw new Error("未授权的读取");
    }
  },
});

// 或者我们可以使用 `storageServer.handle` 作为中间件
await listen(storageServer.handle);
```

`storageServer` 是一个 [h3](https://github.com/unjs/h3) 实例。还可以查看 [listhen](https://github.com/unjs/listhen) 以获得优雅的 HTTP 监听器。

::warning
**🛡️ 安全提示：** 请确保始终实现 `authorize` 以保护服务器在暴露于生产环境时的安全。
::

## 存储客户端

您可以使用 [http 驱动程序](/drivers/http) 轻松连接到服务器。

```ts
import { createStorage } from "unstorage";
import httpDriver from "unstorage/drivers/http";

const client = createStorage({
  driver: httpDriver({
    base: "SERVER_ENDPOINT",
  }),
});
const keys = await client.getKeys();
```

## HTTP 方法

- `GET`：当路径以 `/` 或 `/:` 结尾时，映射到 `storage.getItem` 或 `storage.getKeys`
- `HEAD`：映射到 `storage.hasItem`。如果未找到，则返回 404。
- `PUT`：映射到 `storage.setItem`。值从请求体中读取，如果操作成功则返回 `OK`。
- `DELETE`：当路径以 `/` 或 `/:` 结尾时，映射到 `storage.removeItem` 或 `storage.clear`。如果操作成功则返回 `OK`。

::note
当为 GET 和 SET 操作传递 `accept: application/octet-stream` 时，服务器通过 `getItemRaw` 和 `setItemRaw` 切换到二进制模式。
::